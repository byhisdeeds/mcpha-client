<!DOCTYPE html>
<!--
Copyright 2016 John Preston<byhisdeeds@gmail.com> NURAS.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>WSPHA</title>
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="css/jspha.css" >
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../../excanvas.min.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="js/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="js/jquery-ui.js"></script>
    <script language="javascript" type="text/javascript" src="js/jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="js/jquery.flot.crosshair.js"></script>
    <script language="javascript" type="text/javascript" src="js/jquery.flot.selection.js"></script>
    <script language="javascript" type="text/javascript" src="js/jquery.flot.resize.js"></script>
    <script language="javascript" type="text/javascript" src="js/notify.js"></script>
    <script type="text/javascript">

      $(function () {

        var ws;
        
        // Check that page is loaded via http protocol
        if (window.location.protocol === "file:")
        {
          document.write("ERROR: This app must be loaded via a http web server.");
          return;
        }

//  var data,data1,options,chart;
//  data1 = [ [1,5],[2,5],[3,6],[4,9],[5,7],[6,6],[7,2],[8,1],[9,3] ];
//  var data2 = [], data3=[];
//  for(var i = 1; i < 10; i++) { data2.push([i,i * 2])}
//  for(var i = 1; i < 10; i++) { data3.push([i,10 * Math.random()])}
//  data = [{ data:data1, label:"fixed", lines:{show:true}}
//        ,{ data:data2, label:"linear", lines:{show:true}, points:{show:true}}
//        ,{ data:data3, label:"random", bars:{ show:true, barWidth:0.5}}];
//  options = {legend:{position:"nw"}};
//  $(document).ready(function(){
//  	chart = $.plot($("#placeholder"),data,options);
//  });

        initConnectionStatus();

        if ("WebSocket" in window) {
          
          updateConnectionStatus("ctws");
          
          ws = new WebSocket("ws://localhost:4567/wspha");
          
          ws.onopen = function () {
            updateConnectionStatus("wsce");
          };
          
          ws.onmessage = function (evt) {
            msg = JSON.parse(evt.data);
            if (msg.command === "connect") {
              logMessage(">>"+evt.data);
              if (msg.type !== "req") {
                if (msg.status === 0) {
                  $.notify(msg.message, "success");
                  updateConnectionStatus("rpce");
                  $( "#deviceip" ).text("Disconnect from Device");
                } else {
                  $.notify(msg.message, "error");
                  updateConnectionStatus("rpcd");
                  $( "#deviceip" ).text("Connect to Device");
                }
              }
            } else if (msg.command === "disconnect") {
              logMessage(">>"+evt.data);
              if (msg.status === 0) {
                $.notify(msg.message, "success");
                updateConnectionStatus("rpcd");
                $( "#deviceip" ).text("Connect to Device");
              } else {
                $.notify(msg.message, "error");                
              }
            } else if (msg.command === "getdata") {
              if (msg.status === 0) {
                var axis = plot.getAxes();
                options.xaxis.min = 0;
                options.xaxis.max = 16300;
                options.yaxis.min = 0;
                options.yaxis.max = 4000;
                options.xaxis.tickSize = 1000;
                data.length = 0;
                data.push({label:msg.label, data:msg.data});
                $.plot("#spectrum-placeholder", data, options);
              } else {
                $.notify(msg.message, "error");                
              }
            } else if (msg.command === "set_acquisition_time") {
              logMessage(">>"+evt.data);
              if (msg.type === "req") {
                $( "#acqtime_s" ).text(msg.value);                
              } else {
                if (msg.status === 0) {
                  
                } else {
                
                }
              }
            } else if (msg.command === "set_roi") {
              logMessage(">>"+evt.data);
              roi2set = "";
              if (msg.type !== "req") {
                if (msg.status === 0) {
                  if (msg.roi === 1) {
                    localStorage.setItem('rp_roi1_start', msg.start);
                    localStorage.setItem('rp_roi1_end', msg.end);
                    $( "#roi1_counts" ).text(msg.counts);
                    $( "#roi1_counts" ).prop("title", "From "+msg.start+" to "+msg.end);
                  } else if (msg.roi === 2) {
                    localStorage.setItem('rp_roi2_start', msg.start);
                    localStorage.setItem('rp_roi2_end', msg.end);
                    $( "#roi2_counts" ).text(msg.counts);
                    $( "#roi2_counts" ).prop("title", "From "+msg.start+" to "+msg.end);
                  } else if (msg.roi === 3) {
                    localStorage.setItem('rp_roi3_start', msg.start);
                    localStorage.setItem('rp_roi3_end', msg.end);
                    $( "#roi3_counts" ).text(msg.counts);
                    $( "#roi3_counts" ).prop("title", "From "+msg.start+" to "+msg.end);
                  }
                }
              }
            }
          };
          
          ws.close = function() {
            // Web Socket has been closed
            updateConnectionStatus("wscd");
          };
          
          ws.onerror = function (evt) {
            logMessage("**"+evt.data);
            alert("->"+evt.data);
          };
        } else {
          document.write("ERROR: This browser does NOT support websockets. Please use a HTML5 compliant browser.");
          return;
        }

        function logMessage(message) {
          $("<p>"+message+"</p>").appendTo('#message-log');
        }

        function initConnectionStatus() {
          $("#wsconnection").css("background-image","url(css/images/disconnected.png)");
          $("#wsconnection").prop("title", "Disconnected from web socket server");
        
          $("#rpconnection").css("background-image","url(css/images/disconnected.png)");
          $("#rpconnection").prop("title", "Disconnected from Red Pitaya device");
        }

        function updateConnectionStatus(mode) {
          if (mode === "ctws") {
            // connecting to web socket
            $("#wsconnection").css("background-image","url(css/images/spin.svg)");
            $("#wsconnection").prop("title", "Connecting to web socket");
            setAcquisitionButtonsEnabled( false );
          } else if (mode === "wsce"){
            // Web socket connection established
            $("#wsconnection").css("background-image","url(css/images/connected.png)");
            $("#wsconnection").prop("title", "Web socket server connection established");
            setAcquisitionButtonsEnabled( false );
          } else if (mode === "wscd"){
            // Web socket connection disconnected
            $("#wsconnection").css("background-image","url(css/images/disconnected.png)");
            $("#wsconnection").prop("title", "Web socket server connection disconnected");
            setAcquisitionButtonsEnabled( false );
          } else if (mode === "ctrp") {
            // connecting to red pitaya
            $("#rpconnection").css("background-image","url(css/images/spin.svg)");
            $("#rpconnection").prop("title", "Connecting to Red Pitaya device");
            setAcquisitionButtonsEnabled( false );
          } else if (mode === "rpce") {
            // red pitaya connection established
            $("#rpconnection").css("background-image","url(css/images/connected.png)");
            $("#rpconnection").prop("title", "Red Pitaya device connection established");
            setAcquisitionButtonsEnabled( true );
          } else if (mode === "rpcd") {
            // red pitaya connection disconnected
            $("#rpconnection").css("background-image","url(css/images/disconnected.png)");
            $("#rpconnection").prop("title", "Red Pitaya device connection disconnected");
            setAcquisitionButtonsEnabled( false );
          }
        }

        function setAcquisitionButtonsEnabled(state) {
          if (state) {
            $("#setacqtime").removeAttr("disabled");
            $("#setacqtime").css("color", "#000");
            $("#start").removeAttr("disabled");
            $("#start").css("color", "#000");
            $("#stop").removeAttr("disabled");
            $("#stop").css("color", "#000");
            $("#clear").removeAttr("disabled");
            $("#clear").css("color", "#000");
            $("#roi1").removeAttr("disabled");
            $("#roi1").css("color", "#000");
            $("#roi2").removeAttr("disabled");
            $("#roi2").css("color", "#000");
            $("#roi3").removeAttr("disabled");
            $("#roi3").css("color", "#000");
          } else {
            $("#setacqtime").attr("disabled", "disabled");
            $("#setacqtime").css("color", "#aaa");
            $("#start").attr("disabled", "disabled");
            $("#start").css("color", "#aaa");
            $("#stop").attr("disabled", "disabled");
            $("#stop").css("color", "#aaa");
            $("#clear").attr("disabled", "disabled");
            $("#clear").css("color", "#aaa");
            $("#roi1").attr("disabled", "disabled");
            $("#roi1").css("color", "#aaa");
            $("#roi2").attr("disabled", "disabled");
            $("#roi2").css("color", "#aaa");
            $("#roi3").attr("disabled", "disabled");
            $("#roi3").css("color", "#aaa");
          }
        }
    
        function yscaleFunction (y) {
          return y * .5;
        }

        function calculateFullExtent (variable) {
          var xmin =  10000000;
          var xmax = -10000000;
          var ymin =  10000000;
          var ymax = -10000000;
          
          $.each(variable, function(index, value) {
            $.each(value.data, function(index, value) {
              if (value[0] > xmax) {
                xmax = value[0];
              }
              if (value[0] < xmin) {
                xmin = value[0];
              }
              if (value[1] > ymax) {
                ymax = value[1];
              }
              if (value[1] < ymin) {
                ymin = value[1];
              }
            });
          });
          
          return {"xmin" : xmin, "xmax": xmax, "ymin": ymin, "ymax": ymax};
        }

        // initialise device ip address
        if (localStorage.getItem('rp_ipaddr') === null) {
          localStorage.setItem('rp_ipaddr', "0.0.0.0");
          localStorage.setItem('rp_port', "0");
        }

        var allFields = $( [] ).add( ipaddr );
        var dialog_ipaddr = $( "#dialog-ipaddr" ).dialog({
          autoOpen: false,
          height: 400,
          width: 400,
          modal: true,
          buttons: {
            "Connect": function() {
              // Put the object into storage
              localStorage.setItem('rp_ipaddr', $( "#ipaddr" ).val());
              localStorage.setItem('rp_port', $( "#port" ).val());
              // connect to red pitaya device
              updateConnectionStatus("ctrp");
              ws.send("{\"type\":\"req\",\"command\":\"connect\",\"deviceip\":\""+$("#ipaddr").val()+"\",\"port\":"+$("#port").val()+"}");
              // close dialog
              dialog_ipaddr.dialog( "close" );
              // set initial roi #1 value
              if (localStorage.getItem('rp_roi1_start') === null) {
                $( "#roi1_counts" ).text(0);
              } else {
                ws.send("{\"type\":\"req\",\"command\":\"set_roi\",\"roi\":1,\"from\":"+localStorage.getItem('rp_roi1_start')+",\"to\":"+localStorage.getItem('rp_roi1_end')+"}");
              }
              // install click handler
              $("#roi1").click(function () {
                roi2set = "1";
                $.notify("Select ROI #1 region using mouse", "info");
              });

              // set initial roi #2 value
              if (localStorage.getItem('rp_roi2_start') === null) {
                $( "#roi2_counts" ).text(0);
              } else {
                ws.send("{\"type\":\"req\",\"command\":\"set_roi\",\"roi\":2,\"from\":"+localStorage.getItem('rp_roi2_start')+",\"to\":"+localStorage.getItem('rp_roi2_end')+"}");
              }
              // install click handler
              $("#roi2").click(function () {
                roi2set = "2";
                $.notify("Select ROI #2 region using mouse", "info");
              });

              // set initial roi #3 value
              if (localStorage.getItem('rp_roi3_start') === null) {
                $( "#roi3_counts" ).text(0);
              } else {
                ws.send("{\"type\":\"req\",\"command\":\"set_roi\",\"roi\":3,\"from\":"+localStorage.getItem('rp_roi3_start')+",\"to\":"+localStorage.getItem('rp_roi3_end')+"}");
              }
              // install click handler
              $("#roi3").click(function () {
                roi2set = "3";
                $.notify("Select ROI #3 region using mouse", "info");
              });
            },
            Cancel: function() {
              dialog_ipaddr.dialog( "close" );
            }
          },
          close: function() {
            form[ 0 ].reset();
            allFields.removeClass( "ui-state-error" );
          }
        });
        
        var form = dialog_ipaddr.find( "form" ).on( "submit", function( event ) {
          event.preventDefault();
        });
        
        var dialog_acqtime = $( "#dialog-acqtime" ).dialog({
          autoOpen: false,
          height: 400,
          width: 400,
          modal: true,
          buttons: {
            "OK": function() {
              // Put the object into storage
              localStorage.setItem('rp_acqtime', $( "#acqtime" ).val());
              // connect to red pitaya device
              ws.send("{\"type\":\"req\",\"command\":\"set_acquisition_time\",\"value\":"+$("#acqtime").val()+"}");
              // close dialog
              dialog_acqtime.dialog( "close" );
            },
            Cancel: function() {
              dialog_acqtime.dialog( "close" );
            }
          },
          close: function() {
            form[ 0 ].reset();
            allFields.removeClass( "ui-state-error" );
          }
        });
        
        var form = dialog_acqtime.find( "form" ).on( "submit", function( event ) {
          event.preventDefault();
        });

        $("button.deviceip").click(function () {
          if ($( "#deviceip" ).text().startsWith("Connect")) {
            // read the red pitaya device address from storage
            $( "#ipaddr" ).val(localStorage.getItem('rp_ipaddr'));
            $( "#port" ).val(localStorage.getItem('rp_port'));
            dialog_ipaddr.dialog( "open" );
          } else {
            ws.send("{\"type\":\"req\",\"command\":\"disconnect\"}");
          }
        });
        
        var options = {
          lines: {
            show: true,
            steps: true
          },
          points: {
            show: false
          },
          xaxis: {
            tickDecimals: 0,
            tickSize: 1,
            transform: function(x) {
              return x;
            }
          },
          yaxis: {
            ticks: [0.1,1,10,100,1000],
            transform:  function(v) {
              return Math.log(v+0.0001); /*move away from zero*/
            },
            tickDecimals: 3,
            tickFormatter: function (v, axis) {
              return "10" + (Math.round( Math.log(v)/Math.LN10)).toString().sup();
            }
          },
          grid: {
            backgroundColor: "#999",
            hoverable: true,
            clickable: true,
            autoHighlight: false
          },
          crosshair: {
            mode: "x"
          },
          zoom: {
            interactive: true
          },
          pan: {
            interactive: true
          },
          selection: {
            mode: "x"
          }
        };

        var yscale = "ln";
        
        var roi2set = "";
        
        var data = [];

        var plot = $.plot("#spectrum-placeholder", data, options);

        // Fetch one series, adding to what we already have
        $("#spectrum-placeholder").bind("plothover", function(event, pos, item) {
          if (item) {
            $("#spectrum-placeholder").css("cursor","pointer","important");
          } else {
            $("#spectrum-placeholder").css("cursor","crosshair", "important");
          }
        });
        
        var alreadyFetched = {};

        // Set Y display to linear
        $("button.yscale-ln-button").click(function () {
          yscale = "ln";
          options.yaxis.ticks = null;
          options.yaxis.transform = null;
          options.yaxis.tickDecimals = null;
          options.yaxis.tickFormatter = null;
          plot = $.plot("#spectrum-placeholder", data, options);
        });

        // Set Y display to square root
        $("button.yscale-sq-button").click(function () {
          yscale = "sq";
          options.yaxis.ticks = null;
          options.yaxis.transform = function(v) {
            return Math.sqrt(v+0.0001); /*move away from zero*/
          };
          options.yaxis.tickDecimals = null;
          options.yaxis.tickFormatter = null;
          plot = $.plot("#spectrum-placeholder", data, options);
        });

        // Set Y display to log10
        $("button.yscale-lg-button").click(function () {
          yscale = "lg";
          options.yaxis.ticks = [0.1,1,10,100,1000];
          options.yaxis.transform = function(v) {
            return Math.log10(v+0.0001); /*move away from zero*/
          };
          options.yaxis.tickDecimals = 3;
          options.yaxis.tickFormatter = function (v, axis) {
            return "10" + (Math.round( Math.log10(v)/Math.LN10)).toString().sup();
          };
          plot = $.plot("#spectrum-placeholder", data, options);
        });

        // zoom to full channel extent button click handler
        $("button.zoom-full-extent-button").click(function () {
          var axis = plot.getAxes();
          options.xaxis.min = axis.xaxis.datamin;
          options.xaxis.max = Math.ceil(axis.xaxis.datamax);
          options.yaxis.min = 0;
          options.yaxis.max = Math.ceil(axis.yaxis.datamax);
          plot = $.plot("#spectrum-placeholder", data, options);
        });

        $("button.zoom-in-button").click(function () {
          var axis = plot.getAxes();
          var xrng = (options.xaxis.max - options.xaxis.min) / 4;
          if (xrng < 2) {
            return;
          }
          options.xaxis.min += xrng;
          if (options.xaxis.min < axis.xaxis.datamin) {
            options.xaxis.min = axis.xaxis.datamin;
          }
          options.xaxis.max -= xrng;
          if (options.xaxis.max > axis.xaxis.datamax) {
            options.xaxis.max = axis.xaxis.datamax;
          }
          plot = $.plot("#spectrum-placeholder", data, options);
        });

        $("button.zoom-out-button").click(function () {
          var axis = plot.getAxes();
          var xrng = (options.xaxis.datamax - options.xaxis.datamin) / 4;
          if (xrng < 2) {
            return;
          }
          options.xaxis.min -= xrng;
          if (options.xaxis.min < axis.xaxis.datamin) {
            options.xaxis.min = axis.xaxis.datamin;
          }
          options.xaxis.max += xrng;
          if (options.xaxis.max > axis.xaxis.datamax) {
            options.xaxis.max = axis.xaxis.datamax;
          }
          plot = $.plot("#spectrum-placeholder", data, options);
        });

        $("button.pan-button").click(function () {
//          plot.pan({ left: -2 });
          options.xaxis.min = 5400;
          options.xaxis.max = 5500;
          plot = $.plot("#spectrum-placeholder", data, options);
        });

        // set initial acquisition time
        if (localStorage.getItem("rp_acqtime") === null) {
          // use default value of 60 seconds
          localStorage.setItem('rp_acqtime', "60");
        }
        $( "#acqtime_s" ).text(localStorage.getItem("rp_acqtime"));
        
        // install set acquisition button click handler
        $("#setacqtime").click(function () {
          $( "#acqtime" ).val(localStorage.getItem('rp_acqtime'));
          dialog_acqtime.dialog( "open" );
        });
        
        // set initial elapsedtime
        $( "#elapsedtime" ).text("0");

        // 
        $("#start").click(function () {
          alert("STARt ACQUISITION");
        });

        $("#stop").click(function () {
          alert("STOP ACQUISITION");
        });

        $("#clear").click(function () {
          alert("CLEAR SPECTUM DATA");
        });

        // set initial roi #1 value
        $( "#roi1_counts" ).text(0);
        $( "#roi2_counts" ).text(0);
        $( "#roi3_counts" ).text(0);

        // install click handler
        $("#roi3").click(function () {
          roi2set = "3";
          $.notify("Select ROI #3 region using mouse", "info");
        });

        $("#spectrum-placeholder").bind("plotselected", function (event, ranges) {
          if (roi2set !== "") {
            // $("#selection").text(ranges.xaxis.from.toFixed(1) + " to " + ranges.xaxis.to.toFixed(1));
            ws.send("{\"type\":\"req\",\"command\":\"set_roi\",\"roi\":"+roi2set+",\"from\":"+ranges.xaxis.from.toFixed(0)+",\"to\":"+ranges.xaxis.to.toFixed(0)+"}");
            plot.clearSelection();
          }
        });

        $("#spectrum-placeholder").bind("plothover", function (event, pos, item) {
          if (data.length > 0) {
            $("#cursor").text(pos.x.toFixed(0));
            if (yscale === "ln") {
              $("#counts").text(pos.y.toFixed(0));
            } else if (yscale === "sq") {
              $("#counts").text(pos.y.toFixed(2)*pos.y.toFixed(2));
            } else if (yscale === "lg") {
              $("#counts").text(Math.pow(10,pos.y.toFixed(2)));
            }
          }
        });
        $("#cursor").text("0");

        // Catch keypressess
        // left = 37, up = 38, right = 39, down = 40
        $(document).keyup(function (e) {
          if (e.which === 37) {
            alert('You pressed left!');
          } else if (e.which === 38) {
            alert('You pressed up!');
          } else if (e.which === 39) {
            alert('You pressed right!');
          } else if (e.which === 40) {
            alert('You pressed down!');
          } else if (e.which === 13) {
            alert('You pressed enter!');
          }
        });
        
        setAcquisitionButtonsEnabled(false);
        
        $( "#tabs" ).tabs();
        $( "#tabs ul li").css({'margin-right':'25px'});
//        $(".spectrum-container").resizable({
//          maxWidth: 900,
//          maxHeight: 500,
//          minWidth: 450,
//          minHeight: 250
//        });
      });

    </script>
  </head>
  <body>

    <div id="content">
      
      <div class="connection-panel-container">
        <div class="connection-panel-content">
          <div class="wsconnection" id="wsconnection" title="Websocket connection status"></div>
          <div class="rpconnection" id="rpconnection" title="Red Pitaya device connection status"></div>
          <button class="deviceip" id="deviceip" title="Set Red Pitaya device IP">Connect to Device</button>
        </div>
      </div>

      <div id="tabs">
        <div id="fragment-mca">

          <div class="cursor-panel-container">
            <div class="cursor-panel-content">Cursor ......... : <span class="onscreen-message" id="cursor"></span>
Counts ......... : <span class="onscreen-message" id="counts"></span>
Acq. Time (s) .. : <span class="onscreen-message" id="acqtime_s"></span>
Elapsed Time (s) : <span class="onscreen-message" id="elapsedtime"></span>
ROI #1 ......... : <span class="onscreen-message" id="roi1_counts"></span>
ROI #2 ......... : <span class="onscreen-message" id="roi2_counts"></span>
ROI #3 ......... : <span class="onscreen-message" id="roi3_counts"></span></div>
          </div>

          <div class="spectrum-container">
            <div id="header">
              <button class="zoom-full-extent-button" title="Zoom channel view to full extent"></button>
              <button class="zoom-in-button" title="Zoom channel view in"></button>
              <button class="zoom-out-button" title="Zoom out channel view"></button>
              <button class="pan-button" title="Pan channel view"></button>
              <div style="width:8px;display:inline-block"></div>
              <button class="yscale-ln-button" title="Linear vertical scale">LN</button>
              <button class="yscale-sq-button" title="Square Root vertical scale">SQ</button>
              <button class="yscale-lg-button" title="Log 10 vertical scale">LG</button>
            </div>
            <div class="controls-panel-container">
              <div class="controls-panel-content">
                <button class="setacqtime" id="setacqtime" title="Set acquisition time">Acq. Time</button>
                <button class="start" id="start" title="Start spectrum acquisition">Start</button>
                <button class="stop" id="stop" title="Stop spectrum acquisition">Stop</button>
                <button class="clear" id="clear" title="Clear spectrum data">Clear</button>
                <div style="width:8px;display:inline-block"></div>
                <button class="roi1" id="roi1" title="Set ROI #1">ROI #1</button>
                <button class="roi2" id="roi2" title="Set ROI #2">ROI #2</button>
                <button class="roi3" id="roi3" title="Set ROI #3">ROI #3</button>
              </div>
            </div>
            <div id="spectrum-placeholder" class="spectrum-placeholder"></div>
          </div>
        </div>

        <div id="dialog-ipaddr" title="Red Pitaya Device IP Address/Port">
          <p class="dialogPrompt">Enter device IP address and port.</p>

          <form>
            <fieldset>
              <label for="ipaddr">IP Address</label>
              <input type="text" name="ipaddr" id="ipaddr" value="0.0.0.0" class="text ui-widget-content ui-corner-all">

              <label for="port">Port</label>
              <input type="text" name="port" id="port" value="0" class="text ui-widget-content ui-corner-all">

              <!-- Allow form submission with keyboard without duplicating the dialog button -->
              <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
            </fieldset>
          </form>
        </div>

        <div id="dialog-acqtime" title="Aquisition Time">
          <p class="dialogPrompt">Enter acquisition time in seconds.</p>

          <form>
            <fieldset>
              <label for="acqtime">Acquisition Time (s)</label>
              <input type="text" name="acqtime" id="acqtime" value="60" class="text ui-widget-content ui-corner-all">

              <!-- Allow form submission with keyboard without duplicating the dialog button -->
              <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
            </fieldset>
          </form>
        </div>
        <div id="fragment-oscilloscope">
          <div id="content">
            Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.
            Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.
          </div>
        </div>
        <div id="fragment-log">
          <div id="content">
            <div id="message-log"></div>
          </div>
        </div>
        <ul>
          <li><a href="#fragment-mca"><span>MCA</span></a></li>
          <li><a href="#fragment-oscilloscope"><span>Oscilloscope</span></a></li>
          <li><a href="#fragment-log"><span>Message Log</span></a></li>
        </ul>
      </div>
    </div>
  
  </body>
</html>